// (FSRCNNX_x2_8-0-4-1_LA) mapping 2_2


cbuffer constants : register(b0) {
	int2 srcSize : packoffset(c0.x);
};


#define MAGPIE_INPUT_COUNT 2
#include "common.hlsli"

#define get0(pos) uncompressLinear(SampleInput(0, pos), -2.5, 3.5)
#define get1(pos) uncompressLinear(SampleInput(1, pos), -1.5, 3.5)


D2D_PS_ENTRY(main) {
	InitMagpieSampleInput();

	float2 leftTop = max(0, Coord(0).xy - Coord(0).zw);
	float2 rightBottom = min(maxCoord0.xy, Coord(0).xy + Coord(0).zw);

	float4 res = { -0.0375947281718254,0.2783663868904114,0.0855874642729759,-0.0183580406010151 };
	res += mul(get0(leftTop), float4x4(-0.3375159502029419, -0.0481248162686825, 0.0022695809602737, -0.1379150450229645, 0.2087368816137314, -0.1413425505161285, 0.0311671234667301, 0.2090687304735184, -0.1255441159009933, -0.3856352567672729, 0.0592494457960129, -0.2192105948925018, 0.0635740235447884, -0.0259831510484219, 0.1284605711698532, 0.1543060839176178));
	res += mul(get1(leftTop), float4x4(0.0265662875026464, 0.1603409945964813, -0.0106395082548261, 0.0252655427902937, 0.0633112043142319, 0.1634869277477264, 0.0606260225176811, -0.0386067330837250, 0.1025275588035583, -0.0086877709254622, 0.0572752207517624, 0.2958410382270813, 0.2315495908260345, -0.0511345490813255, -0.0684579163789749, 0.2366850525140762));
	res += mul(get0(float2(leftTop.x, Coord(0).y)), float4x4(-0.6637977361679077, 0.1115299314260483, 0.0334465689957142, -0.0595322623848915, 0.0194256473332644, 0.1154914125800133, -0.0093330284580588, -0.2107555270195007, 0.2593949139118195, -0.2310725152492523, -0.0191440880298615, 0.0831847414374352, 0.0869263112545013, 0.1271044909954071, -0.0199039578437805, 0.0421413294970989));
	res += mul(get1(float2(leftTop.x, Coord(0).y)), float4x4(0.1171221211552620, -0.2125719487667084, -0.0189515724778175, 0.2465390264987946, 0.1773879528045654, 0.2518055438995361, 0.0552976131439209, -0.1894477456808090, 0.1769066900014877, -0.1464872211217880, -0.0573948174715042, -0.4012156426906586, 0.2111275196075439, -0.5377770662307739, -0.2866773009300232, 0.1336809694766998));
	res += mul(get0(float2(leftTop.x, rightBottom.y)), float4x4(-0.6472494006156921, -0.0555078461766243, 0.0564644038677216, 0.0711399838328362, -0.0228650532662868, -0.0755083113908768, 0.0132119813933969, 0.1565485745668411, 0.0769101306796074, -0.4400988519191742, -0.0369989611208439, -0.0459617786109447, 0.1246264874935150, -0.2121030986309052, 0.0351070538163185, 0.1162980273365974));
	res += mul(get1(float2(leftTop.x, rightBottom.y)), float4x4(-0.0239488855004311, -0.4389697015285492, -0.0041466108523309, 0.2026203870773315, 0.0299914367496967, 0.0214463528245687, -0.0340079553425312, -0.0866646468639374, -0.1258078664541245, 0.0335666500031948, 0.0279387012124062, 0.0377361401915550, -0.0037173877935857, -0.1970001310110092, 0.0554011650383472, 0.0747631862759590));
	res += mul(get0(float2(Coord(0).x, leftTop.y)), float4x4(-0.5669959783554077, -0.0150139974430203, -0.0079386057332158, -0.1156958788633347, -0.0749717876315117, 0.1512815952301025, -0.0340143367648125, -0.1504366695880890, -0.1540268361568451, -0.0089722918346524, -0.0974140912294388, -0.4191842377185822, 0.0414282791316509, -0.0518460534512997, -0.1025082096457481, -0.1974052190780640));
	res += mul(get1(float2(Coord(0).x, leftTop.y)), float4x4(0.1328157931566238, -0.0447603911161423, 0.0625142455101013, 0.1125901266932487, 0.1033857688307762, 0.0811788439750671, 0.1270843595266342, -0.0564684942364693, 0.0797754079103470, 0.1379490494728088, -0.2863929569721222, -0.0602805763483047, 0.2699469923973083, 0.1226278319954872, -0.2505964636802673, 0.0639543756842613));
	res += mul(get0(Coord(0).xy), float4x4(-1.5813068151473999, 0.5872991085052490, -0.2429279834032059, -0.4303708970546722, 0.2854560911655426, 1.0167927742004395, 0.8617131114006042, 0.2191447615623474, 0.9627910852432251, 0.7867327332496643, 1.2628984451293945, 0.8908280134201050, -0.4586973786354065, -0.7981753349304199, 0.4780183732509613, -0.9264264106750488));
	res += mul(get1(Coord(0).xy), float4x4(0.2435170710086823, -0.0829131007194519, -0.3455205559730530, 0.4117922484874725, 0.2749316394329071, 0.1895177811384201, 0.4110289216041565, -0.1298204958438873, 0.1637304723262787, 0.8604004383087158, 1.0940867662429810, -0.3959148228168488, 0.3289682567119598, -0.0633709058165550, -2.0705056190490723, 0.1684481352567673));
	res += mul(get0(float2(Coord(0).x, rightBottom.y)), float4x4(-0.8055392503738403, 0.2874773740768433, -0.1400482803583145, -0.1834644526243210, 0.0150187248364091, 0.0192099008709192, -0.0783268958330154, -0.2944276928901672, 0.0451190918684006, 0.1181604787707329, 0.1095703318715096, -0.2282790690660477, 0.1960140317678452, 0.3371279239654541, 0.0243086088448763, -0.0463834926486015));
	res += mul(get1(float2(Coord(0).x, rightBottom.y)), float4x4(0.2196981906890869, -0.0534196794033051, -0.0839012116193771, 0.2049407809972763, 0.0194450635462999, -0.0593264624476433, 0.1640597432851791, 0.0274629276245832, -0.1243807971477509, 0.0611803941428661, -0.1799024045467377, -0.1864561140537262, 0.2465235143899918, -0.0211831126362085, -0.2282803803682327, -0.1430586874485016));
	res += mul(get0(float2(rightBottom.x, leftTop.y)), float4x4(-0.3611976802349091, 0.0288475938141346, -0.0297703798860312, -0.0418547466397285, -0.3251218497753143, -0.0134126413613558, -0.0686949566006660, -0.0233805924654007, -0.2749838531017303, -0.2486374378204346, 0.0724888965487480, 0.1193816959857941, -0.2721751034259796, -0.2033173292875290, 0.0248280912637711, 0.0589503161609173));
	res += mul(get1(float2(rightBottom.x, leftTop.y)), float4x4(0.1689156740903854, 0.0712056383490562, 0.1930764019489288, 0.0722641199827194, 0.0640723854303360, 0.0566449724137783, 0.0815568938851357, -0.0213705692440271, -0.1826065927743912, 0.0393006950616837, -0.1493768393993378, 0.0386883616447449, -0.0130320172756910, -0.0327960774302483, -0.0204591657966375, 0.0134796360507607));
	res += mul(get0(float2(rightBottom.x, Coord(0).y)), float4x4(-0.5736998319625854, -0.0392777882516384, 0.1370634734630585, -0.0484432727098465, 0.1308025121688843, -0.2323654592037201, -0.2625242173671722, -0.2956316471099854, -0.1103305667638779, -0.0551420338451862, 0.0006514643318951, 0.0022458140738308, 0.2859890162944794, -0.0839410424232483, 0.5223253369331360, 0.0280438754707575));
	res += mul(get1(float2(rightBottom.x, Coord(0).y)), float4x4(0.0556896403431892, 0.0735942423343658, -0.2387326955795288, 0.1338670998811722, 0.0996377170085907, 0.0365633517503738, 0.3044275343418121, -0.0164738632738590, 0.1139278411865234, 0.1249758303165436, 0.2395293861627579, -0.0708516016602516, 0.1228865459561348, 0.0634353235363960, -0.3463226258754730, -0.0362484715878963));
	res += mul(get0(rightBottom), float4x4(-0.4082182049751282, -0.1144043654203415, 0.0233679264783859, 0.0130491442978382, 0.0237790253013372, 0.0709472149610519, 0.1275831013917923, -0.0888639837503433, -0.0140889342874289, -0.1301848441362381, -0.1709596514701843, 0.0314525589346886, 0.0293366052210331, 0.0934117212891579, 0.0720594301819801, 0.0094668027013540));
	res += mul(get1(rightBottom), float4x4(0.1782542318105698, -0.1532294601202011, -0.2839424610137939, 0.0435897931456566, 0.0621095262467861, -0.0348550342023373, 0.0461588650941849, 0.0183234252035618, 0.2204841077327728, 0.1267120093107224, 0.1979495882987976, -0.2149147540330887, 0.2110942006111145, 0.0718472301959991, -0.1063910648226738, -0.0493422709405422));
	res = max(res, ZEROS4) + float4(-0.0162308197468519, 0.4942881166934967, 0.1156802847981453, 1.4069133996963501) * min(res, ZEROS4);

	return compressTan(res);
}
