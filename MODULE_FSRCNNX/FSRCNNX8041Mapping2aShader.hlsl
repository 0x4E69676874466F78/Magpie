// (FSRCNNX_x2_8-0-4-1) mapping 2_1


cbuffer constants : register(b0) {
	int2 srcSize : packoffset(c0.x);
};


#define MAGPIE_INPUT_COUNT 2
#include "common.hlsli"

#define get0(pos) uncompressTan(SampleInput(0, pos))
#define get1(pos) uncompressTan(SampleInput(1, pos))


D2D_PS_ENTRY(main) {
	InitMagpieSampleInput();

	float2 leftTop = max(0, Coord(0).xy - Coord(0).zw);
	float2 rightBottom = min(maxCoord0.xy, Coord(0).xy + Coord(0).zw);

	float4 res = { 0.0203563515096903,0.1902436912059784,-0.0757935121655464,0.0393617525696754 };
	res += mul(get0(leftTop), float4x4(-0.1080558672547340, -0.0400269515812397, 0.1042881682515144, -0.1994346678256989, 0.0172465778887272, -0.0829331055283546, -0.1278677284717560, -0.0762506872415543, -0.0593080408871174, -0.0305212251842022, 0.1326192617416382, -0.3380933105945587, -0.0722763314843178, -0.1975518912076950, -0.0223602931946516, 0.2251029163599014));
	res += mul(get1(leftTop), float4x4(0.1747678220272064, 0.0297168865799904, 0.1054855734109879, 0.0803295820951462, -0.0338115766644478, -0.3885377943515778, -0.3540246784687042, -0.0719623491168022, -0.0656022280454636, -0.0469004511833191, 0.1379419565200806, 0.0319863893091679, 0.0799935683608055, -0.0099127553403378, 0.1698455959558487, -0.0108015276491642));
	res += mul(get0(float2(leftTop.x, Coord(0).y)), float4x4(0.1587898135185242, 0.3995443880558014, -0.0333226583898067, 0.2373267263174057, -0.1616930961608887, 0.0659186244010925, 0.0141129801049829, -0.0541022196412086, -0.5743742585182190, 0.1121487766504288, 0.4259817600250244, 0.0280795227736235, -0.3721714317798615, -0.3496374189853668, 0.0997273251414299, -0.0079920450225472));
	res += mul(get1(float2(leftTop.x, Coord(0).y)), float4x4(0.0928084030747414, 0.3107658624649048, 0.1375299990177155, 0.1550617516040802, -0.0780353918671608, -0.0102957757189870, -0.2056752145290375, -0.3927979469299316, -1.2112152576446533, 0.0213295854628086, 0.1396545022726059, 0.0492016039788723, -0.0569122135639191, -0.1691886335611343, -0.1535325646400452, 0.2800904810428619));
	res += mul(get0(float2(leftTop.x, rightBottom.y)), float4x4(0.2494744062423706, -0.0363066755235195, 0.0959179550409317, -0.0048101749271154, -0.0195793900638819, 0.0451166369020939, 0.1470773071050644, -0.0050059854984283, 0.2886958122253418, -0.3221147954463959, -0.7062104344367981, 0.1646659970283508, -0.0092520527541637, -0.1254461258649826, 0.0217506736516953, -0.0678806379437447));
	res += mul(get1(float2(leftTop.x, rightBottom.y)), float4x4(-0.0686557441949844, -0.0414490625262260, -0.1855954080820084, 0.0264346338808537, -0.0296857114881277, -0.0431593284010887, 0.0669397041201591, -0.0946076661348343, -0.2036914378404617, -0.1336101740598679, -0.2099903970956802, -0.1327936947345734, -0.1002155169844627, -0.0368575826287270, -0.1660962998867035, 0.0728288888931274));
	res += mul(get0(float2(Coord(0).x, leftTop.y)), float4x4(0.5504320859909058, 0.2939232587814331, 0.4704743027687073, 0.2129514217376709, 0.0843106731772423, -0.1978624463081360, -0.3298224806785583, 0.1919094175100327, 0.1980742365121841, -0.0644423812627792, 0.0091170109808445, -0.2124856859445572, 0.0804558470845222, -0.1130188927054405, -0.6276652812957764, 0.1861163526773453));
	res += mul(get1(float2(Coord(0).x, leftTop.y)), float4x4(-0.3357668519020081, 0.2093413323163986, 0.4355416595935822, 0.1550502777099609, -0.6510964035987854, -0.1751857399940491, -0.2060168534517288, -0.1710205078125000, -0.1202360317111015, -0.2500316798686981, 0.1074745431542397, -0.2418434321880341, 0.0133954072371125, -0.0555886104702950, 0.1514673978090286, 0.2739115655422211));
	res += mul(get0(Coord(0).xy), float4x4(-0.3006273508071899, -0.2699472010135651, -0.1982013583183289, -0.0032952548936009, 0.0307833012193441, 0.3671586215496063, -0.0966020002961159, -0.2836556434631348, 0.4297264218330383, 0.6171903610229492, 0.6723483800888062, 0.2705117464065552, -0.1438141316175461, -0.0873940736055374, -0.7001031041145325, -0.2052250355482101));
	res += mul(get1(Coord(0).xy), float4x4(-0.2875024676322937, -1.6230558156967163, -0.6733398437500000, -0.9642448425292969, -0.1964960694313049, 0.2485812455415726, 0.1236900389194489, -1.1423941850662231, -0.0412602946162224, 0.3412002623081207, 0.3962794244289398, -0.2490761876106262, -0.0058065578341484, -0.4578708708286285, -0.2418260127305984, 0.5357795953750610));
	res += mul(get0(float2(Coord(0).x, rightBottom.y)), float4x4(0.0062361713498831, 0.1925230026245117, 0.0824977159500122, 0.0561275146901608, 0.0929671525955200, 0.0698546022176743, 0.3816939592361450, 0.0395248420536518, -0.0719512030482292, 0.0564917400479317, -0.1297784000635147, 0.1245511695742607, 0.0012355837970972, -0.0990515723824501, 0.4213519692420959, -0.1645816713571548));
	res += mul(get1(float2(Coord(0).x, rightBottom.y)), float4x4(-0.0611936338245869, -0.0220258161425591, -0.0040935277938843, -0.1060328409075737, -0.0583154149353504, -0.0171997752040625, 0.1058546081185341, 0.2793170809745789, -0.2339317053556442, -0.1972009539604187, -0.0600687190890312, -0.0684379041194916, 0.0243016034364700, -0.2111079394817352, -0.2042971849441528, 0.0724857896566391));
	res += mul(get0(float2(rightBottom.x, leftTop.y)), float4x4(-0.0833447948098183, -0.0533220991492271, 0.0767802372574806, 0.1182348504662514, -0.0223299078643322, -0.0479344800114632, -0.0119727496057749, 0.0524821877479553, -0.0334780365228653, 0.0719002187252045, 0.0439689308404922, 0.0475181229412556, 0.0764308497309685, 0.0086713796481490, -0.1700707823038101, 0.06573542952537547));
	res += mul(get1(float2(rightBottom.x, leftTop.y)), float4x4(0.1391696482896805, 0.0739523395895958, 0.0565792545676231, -0.0430364646017551, 0.0943084582686424, 0.0102064209058881, 0.0120795257389545, -0.0841303989291191, 0.1573246121406555, 0.0164279472082853, 0.0988841354846954, -0.1430613398551941, -0.0572808869183064, -0.0844292491674423, 0.0621565617620945, 0.0923799052834511));
	res += mul(get0(float2(rightBottom.x, Coord(0).y)), float4x4(-0.1223107874393463, -0.2441930323839188, -0.2410650849342346, -0.0162935722619295, 0.0695567727088928, -0.0028583710081875, -0.0059417244046926, 0.0715164169669151, -0.0668491795659065, -0.1499572396278381, 0.0869924053549767, 0.0553652904927731, 0.2729566097259521, 0.1370039582252502, -0.1282183527946472, -0.1451860070228577));
	res += mul(get1(float2(rightBottom.x, Coord(0).y)), float4x4(0.1331952214241028, 0.0021079662255943, -0.1116734445095062, -0.4168601930141449, 0.0534659475088120, 0.0037860786542296, -0.0366065911948681, 0.1047701835632324, 0.1491260826587677, 0.0782341659069061, 0.0949895009398460, -0.1160908639431000, -0.1057133302092552, -0.2699718773365021, -0.1193305626511574, 0.2142304331064224));
	res += mul(get0(rightBottom), float4x4(0.0041565205901861, -0.1065499857068062, -0.0629659667611122, -0.1144768893718719, 0.0318886637687683, -0.0562519319355488, 0.0043422472663224, 0.0226082988083363, -0.1456198990345001, -0.2398656159639359, -0.2625046670436859, -0.0710547044873238, 0.0067904205061495, 0.0018544088816270, 0.1019348874688148, -0.0186133962124586));
	res += mul(get1(rightBottom), float4x4(0.0732532218098640, 0.1516859829425812, 0.0580205544829369, 0.1968977004289627, -0.0066619524732232, -0.1597842127084732, -0.0990600511431694, -0.1059188917279243, 0.0718481168150902, -0.2222738713026047, -0.1675696671009064, -0.1500017195940018, -0.0568779110908508, -0.0582777932286263, -0.0844587534666061, -0.0263266414403915));
	res = max(res, ZEROS4) + float4(-0.2459529191255569, 0.7563464641571045, -0.0705636814236641, -0.0094820559024811) * min(res, ZEROS4);

	return compressTan(res);
}
