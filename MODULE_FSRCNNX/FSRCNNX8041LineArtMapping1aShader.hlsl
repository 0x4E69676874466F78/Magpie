// (FSRCNNX_x2_8-0-4-1_LA) mapping 1_1


cbuffer constants : register(b0) {
	int2 srcSize : packoffset(c0.x);
};


#define MAGPIE_INPUT_COUNT 2
#include "common.hlsli"

#define get0(pos) uncompressLinear(SampleInput(0, pos), -1, 1.5)
#define get1(pos) uncompressLinear(SampleInput(1, pos), -1, 1)


D2D_PS_ENTRY(main) {
	InitMagpieSampleInput();

	float2 leftTop = max(0, Coord(0).xy - Coord(0).zw);
	float2 rightBottom = min(maxCoord0.xy, Coord(0).xy + Coord(0).zw);

	float4 res = { -0.0031195033807307,-0.0977938771247864,0.0337169878184795,0.0840695425868034 };
	res += mul(get0(leftTop), float4x4(0.0028950418345630, 0.2153117954730988, -0.1120878234505653, 0.1065240651369095, -0.0902118757367134, 0.2227627933025360, -0.1268638819456100, 0.0378417931497097, 0.0262128096073866, 0.1100647151470184, -0.0224360711872578, -0.2487984448671341, 0.3278627693653107, 0.3930607438087463, -0.3361104130744934, -0.2318559885025024));
	res += mul(get1(leftTop), float4x4(-0.1388952732086182, -0.0210590325295925, -0.0107318097725511, 0.1340505480766296, -0.2403931617736816, 0.4324082732200623, -0.1229069381952286, -0.1129430904984474, -0.2194076776504517, -0.2529417872428894, 0.2493167072534561, 0.1228863969445229, -0.6289532780647278, 0.2511698901653290, -0.1145481690764427, -0.1931190490722656));
	res += mul(get0(float2(leftTop.x, Coord(0).y)), float4x4(0.0802633240818977, -0.2823207676410675, -0.0453533977270126, 0.2149281948804855, 0.2391699999570847, -0.3012505769729614, -0.0672336667776108, 0.1134754717350006, -0.1874532252550125, 0.2426864057779312, 0.0001024203302222, -0.2685940861701965, -0.2393693625926971, -0.0148733090609312, 0.4815890491008759, -0.5666245818138123));
	res += mul(get1(float2(leftTop.x, Coord(0).y)), float4x4(0.2353847920894623, 0.7481728792190552, 0.0613395981490612, -0.3136185705661774, -0.6453479528427124, 0.2987860739231110, -0.1935778856277466, -0.4407877624034882, -0.1155721992254257, -0.8143445253372192, -0.1829861551523209, 0.0808847546577454, 0.3689287006855011, -0.1318729221820831, 0.1494798213243484, -0.7250000834465027));
	res += mul(get0(float2(leftTop.x, rightBottom.y)), float4x4(-0.2325237691402435, -0.0383906811475754, -0.0762876123189926, 0.0158057715743780, -0.3222318589687347, -0.0946261659264565, -0.1157991588115692, 0.2080847620964050, -0.1521182358264923, 0.4038263857364655, -0.2508496940135956, 0.0620750486850739, 0.1382832378149033, -0.1788915544748306, -0.1054779291152954, -0.1079574525356293));
	res += mul(get1(float2(leftTop.x, rightBottom.y)), float4x4(0.0441149584949017, -0.1473216116428375, 0.1350974887609482, -0.2101743519306183, 0.4860914349555969, -0.0438372306525707, 0.1496813595294952, 0.1337997019290924, 0.2939592599868774, -0.2875731289386749, 0.3024089336395264, 0.2730985283851624, 0.3860357403755188, -0.2070714235305786, 0.0471001267433167, 0.0515876151621342));
	res += mul(get0(float2(Coord(0).x, leftTop.y)), float4x4(-0.0282726809382439, -0.0808876901865005, -0.1294671446084976, 0.0327957235276699, 0.2005466669797897, 0.0710152760148048, -0.2951858937740326, 0.1284866034984589, -0.3245949447154999, -0.2784474790096283, -0.0651488602161407, 0.2024642229080200, -0.1790685206651688, -0.1523464322090149, 0.0683958381414413, -0.0721997469663620));
	res += mul(get1(float2(Coord(0).x, leftTop.y)), float4x4(0.2084605693817139, 0.2224501073360443, 0.2990169227123260, -0.0822417438030243, 0.1661120802164078, 0.2242873460054398, 0.3008987009525299, -0.0589924007654190, 1.0089585781097412, 0.3364263474941254, 0.3114744126796722, -0.4205997586250305, 0.2149223387241364, -0.2686808407306671, 0.6869788169860840, 0.0397010855376720));
	res += mul(get0(Coord(0).xy), float4x4(-0.1719545274972916, 0.2342357635498047, -0.1108281537890434, 0.0051285717636347, -0.5348495244979858, -0.0063809715211391, -0.2947000265121460, 0.0092384787276387, 0.1788431107997894, -0.8757466077804565, -0.0199933666735888, -0.0933040529489517, -1.1017562150955200, -1.1397477388381958, -0.8490890264511108, 2.0844755172729492));
	res += mul(get1(Coord(0).xy), float4x4(-0.7517850399017334, -0.6626257300376892, -1.7181873321533203, 1.3924138545989990, 0.3148886561393738, 1.2373961210250854, 0.8413697481155396, 0.2569177746772766, 0.1905626207590103, -0.8806108832359314, 0.7340399026870728, 1.8838906288146973, -0.1782593727111816, 0.3429502546787262, -0.3488911390304565, -0.6653195619583130));
	res += mul(get0(float2(Coord(0).x, rightBottom.y)), float4x4(0.1612574905157089, -0.0092199165374041, -0.2294603884220123, 0.2070839852094650, 0.1995067894458771, -0.1586991697549820, -0.1423671096563339, 0.1524601876735687, 0.6368640661239624, -0.1302748024463654, 0.2046667486429214, 0.4024843573570251, 0.3522947132587433, 1.0427794456481934, -0.4195784628391266, -0.7421376705169678));
	res += mul(get1(float2(Coord(0).x, rightBottom.y)), float4x4(-0.0139375794678926, 0.0099870329722762, 0.1957603991031647, 0.2892707288265228, -0.0361699834465981, 0.5173625946044922, -0.0569337680935860, 0.1873179972171783, -1.0557887554168701, 0.2226557582616806, 0.0604930445551872, 0.3329092264175415, -0.1138753890991211, 0.3199435174465179, 0.0987524166703224, 0.1584812700748444));
	res += mul(get0(float2(rightBottom.x, leftTop.y)), float4x4(-0.1148171499371529, 0.0505522675812244, -0.1067250370979309, 0.0587497279047966, -0.3531772792339325, -0.0130594912916422, -0.0051763984374702, 0.0720054879784584, -0.2512235343456268, 0.5235862731933594, 0.1203625276684761, 0.0220968686044216, 0.5066124200820923, -0.2726359069347382, 0.3687904477119446, -0.3189409077167511));
	res += mul(get1(float2(rightBottom.x, leftTop.y)), float4x4(0.2119312435388565, -0.0852348133921623, 0.1512662768363953, 0.0316264666616917, 0.2671527862548828, 0.2980401515960693, -0.1022484675049782, -0.1188400015234947, 0.1485718190670013, 0.2684609889984131, 0.1905853003263474, -0.1392537802457809, 0.4225537180900574, 0.0611033178865910, -0.0134558668360114, -0.2009256333112717));
	res += mul(get0(float2(rightBottom.x, Coord(0).y)), float4x4(-0.0571580827236176, -0.0214836131781340, -0.2749050855636597, 0.0790889635682106, -0.0811165198683739, -0.2081381976604462, -0.3047288656234741, 0.0027117941062897, -0.2009213417768478, -0.7622461318969727, -0.4736055433750153, 0.2779547572135925, 0.4795901477336884, 0.7571166157722473, 1.2372496128082275, -0.7046401500701904));
	res += mul(get1(float2(rightBottom.x, Coord(0).y)), float4x4(-0.1537595987319946, 0.3831464648246765, -0.1571276187896729, -0.1867597997188568, 0.6104238033294678, 0.0229409243911505, 0.2101978808641434, -0.1350114792585373, 0.4454170167446136, 0.3683053851127625, -0.3370352983474731, -0.3944822549819946, -0.4503754675388336, -0.4261152446269989, 0.5954129695892334, 0.0479046516120434));
	res += mul(get0(rightBottom), float4x4(0.2166123390197754, 0.0542660057544708, 0.1477318406105042, 0.1632562726736069, 0.4279211461544037, 0.2100527286529541, -0.0213893372565508, 0.3388189971446991, 0.2154107838869095, -0.2220560610294342, -0.0808312967419624, 0.1158433631062508, -0.1609301865100861, 0.4950682818889618, 0.4356543123722076, -0.0398453846573830));
	res += mul(get1(rightBottom), float4x4(0.0525114983320236, 0.1031088456511497, -0.2437869310379028, -0.1797652095556259, -0.2139296382665634, -0.0230520907789469, 0.0188236199319363, 0.2274840623140335, 0.2199348062276840, -0.0977248921990395, 0.0661730542778969, -0.1618098169565201, -0.1215345263481140, -0.2456843554973602, -0.1434712260961533, -0.1226665675640106));
	res = max(res, ZEROS4) + float4(-0.9874631166458130, 0.2700935602188110, 1.0154639482498169, 0.7301973104476929) * min(res, ZEROS4);

	return compressLinear(res, -2.5, 3.5);
}
