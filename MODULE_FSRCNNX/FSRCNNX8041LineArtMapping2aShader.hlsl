// (FSRCNNX_x2_8-0-4-1_LA) mapping 2_1


cbuffer constants : register(b0) {
	int2 srcSize : packoffset(c0.x);
};


#define MAGPIE_INPUT_COUNT 2
#include "common.hlsli"

#define get0(pos) uncompressLinear(SampleInput(0, pos), -2.5, 3.5)
#define get1(pos) uncompressLinear(SampleInput(1, pos), -1.5, 3.5)


D2D_PS_ENTRY(main) {
	InitMagpieSampleInput();

	float2 leftTop = max(0, Coord(0).xy - Coord(0).zw);
	float2 rightBottom = min(maxCoord0.xy, Coord(0).xy + Coord(0).zw);

	float4 res = { 0.2456959486007690,0.1773831695318222,-0.0800321474671364,-0.1356369554996490 };
	res += mul(get0(leftTop), float4x4(0.0867862403392792, -0.0188770499080420, -0.1502736657857895, -0.1099725291132927, -0.3013791441917419, 0.0430033504962921, 0.0345034115016460, -0.0400283746421337, 0.0455053038895130, -0.0785564482212067, -0.1695308536291122, 0.0467130616307259, -0.0208115540444851, 0.0026763146743178, -0.1338489353656769, -0.1844547539949417));
	res += mul(get1(leftTop), float4x4(0.1620235443115234, 0.0102646192535758, -0.0163768343627453, 0.0822434723377228, 0.1546859890222549, 0.0250307265669107, 0.0373145006597042, -0.0117816952988505, 0.0517709590494633, -0.0252467226237059, -0.1536794751882553, -0.0202652048319578, -0.3231309056282043, 0.1350613087415695, 0.1932685226202011, 0.1793868690729141));
	res += mul(get0(float2(leftTop.x, Coord(0).y)), float4x4(-0.5794479846954346, 0.1861644536256790, 0.1153499931097031, 0.1069827228784561, 0.4245908558368683, 0.1373304873704910, -0.1780052036046982, 0.0466761402785778, -1.1490619182586670, 0.8257195353507996, 0.0008257642621174, 0.0699498802423477, 0.3857855796813965, 0.1599738448858261, -0.0160159282386303, -0.1072350814938545));
	res += mul(get1(float2(leftTop.x, Coord(0).y)), float4x4(-0.0448461174964905, -0.1027067080140114, 0.1546361148357391, -0.1321994811296463, 0.3319362998008728, 0.0670638754963875, -0.0980701223015785, -0.1242648735642433, 0.0487120002508163, 0.1034812107682228, -0.3318608701229095, -0.0663819089531898, -0.7049940824508667, -0.2681597173213959, 0.5434955358505249, 0.3798713982105255));
	res += mul(get0(float2(leftTop.x, rightBottom.y)), float4x4(-0.1650677323341370, -0.1774029582738876, -0.0693891644477844, 0.0644233599305153, 0.0096654882654548, 0.0590313524007797, -0.0626199543476105, -0.1101114749908447, -0.0919653624296188, -0.2198607474565506, -0.3686812222003937, -0.0030939118005335, -0.0286871381103992, -0.0267137177288532, -0.2114386558532715, -0.1006813868880272));
	res += mul(get1(float2(leftTop.x, rightBottom.y)), float4x4(-0.1621828079223633, -0.3327856957912445, -0.3447196483612061, -0.0941574051976204, 0.1980617940425873, -0.0039776018820703, 0.0631400719285011, -0.0371704883873463, 0.0801121518015862, -0.2228745818138123, -0.1361533999443054, -0.0061448244377971, -0.2867666780948639, -0.0285903755575418, -0.2431204020977020, 0.0123175233602524));
	res += mul(get0(float2(Coord(0).x, leftTop.y)), float4x4(-0.0213332772254944, 0.0521896183490753, 0.1267389953136444, 0.0592065081000328, 0.2370698899030685, -0.0788677260279655, -0.0918647274374962, 0.0576282069087029, -0.0021516692359000, -0.1609319597482681, 0.1739181131124496, 0.4105915725231171, -0.0331462696194649, 0.0667985677719116, 0.0239557847380638, 0.2053552418947220));
	res += mul(get1(float2(Coord(0).x, leftTop.y)), float4x4(0.0452669933438301, -0.0624216794967651, -0.2210896909236908, -0.2319414317607880, 0.0553048253059387, -0.0195244718343019, -0.0948461145162582, -0.1411011815071106, 0.1357870846986771, -0.0044978843070567, 0.0117386765778065, 0.2855076789855957, 0.0721756964921951, 0.0725790113210678, 0.0879172906279564, 0.2261598110198975));
	res += mul(get0(Coord(0).xy), float4x4(0.1625189036130905, 0.2556113302707672, 0.0096751591190696, 0.4720825850963593, 0.1724947541952133, 0.7794855833053589, -0.5798769593238831, -0.5527915954589844, -0.2930226027965546, -0.1513507068157196, -0.1671935617923737, 0.1259696036577225, -1.5636392831802368, -0.6248261332511902, -0.7778694629669189, 0.7258287668228149));
	res += mul(get1(Coord(0).xy), float4x4(-0.2203702777624130, -0.2413295805454254, 0.5873484611511230, 0.8019542694091797, 0.2896324992179871, -0.0073753874748945, -0.4705016911029816, -0.4037020802497864, -0.5916352272033691, 0.8720123767852783, 1.4509203433990479, -0.4347604215145111, 0.1296572685241699, -0.0382503382861614, 1.0146147012710571, 0.6662492156028748));
	res += mul(get0(float2(Coord(0).x, rightBottom.y)), float4x4(0.1450282633304596, 0.1838535815477371, -0.2957614958286285, -0.1175402477383614, 0.0455737337470055, -0.1042275950312614, 0.2409446090459824, 0.2161487638950348, 0.2523523867130280, -0.1657318323850632, 0.3264083266258240, 0.0015554791316390, 0.0756938308477402, 0.6486120820045471, 0.2910028994083405, 0.0061267162673175));
	res += mul(get1(float2(Coord(0).x, rightBottom.y)), float4x4(0.1902535557746887, -1.9667011499404907, 0.5702443718910217, 0.1346294432878494, -0.1391871571540833, 0.0248745214194059, -0.0059022656641901, -0.1015660688281059, -0.0244528464972973, 0.6021597385406494, 0.1408251225948334, 0.1453502923250198, 0.1481679081916809, -0.0782008916139603, 0.1340244859457016, 0.2094520628452301));
	res += mul(get0(float2(rightBottom.x, leftTop.y)), float4x4(0.0108401505276561, 0.0073569868691266, 0.0448315776884556, 0.0920599550008774, -0.0208782758563757, -0.0072226687334478, 0.1590231209993362, 0.0974729061126709, -0.0504082255065441, -0.1492372304201126, -0.0240942239761353, -0.3387995064258575, -0.0284501910209656, -0.0475567393004894, -0.1351375281810760, -0.0968868359923363));
	res += mul(get1(float2(rightBottom.x, leftTop.y)), float4x4(-0.0175144840031862, 0.0215768050402403, -0.2070538252592087, -0.1020313948392868, -0.0632536634802818, 0.0187655575573444, 0.0033090459182858, 0.0483726076781750, 0.0874270573258400, 0.0391933582723141, -0.0733725428581238, 0.0455813333392143, 0.0519542098045349, -0.0167136136442423, 0.0001770213857526, -0.0226714108139277));
	res += mul(get0(float2(rightBottom.x, Coord(0).y)), float4x4(0.0230981707572937, 0.0211336743086576, -0.0202524177730083, 0.0004777485737577, -0.3133100867271423, -0.2222708314657211, -0.3225338459014893, 0.0252504348754883, -0.1565012782812119, -0.1223759651184082, -0.1677924543619156, 0.1436173915863037, -0.1002913638949394, -0.4352810978889465, -0.1214068830013275, 0.1200122535228729));
	res += mul(get1(float2(rightBottom.x, Coord(0).y)), float4x4(0.2746300697326660, 0.0240563396364450, 0.2214205712080002, -0.0140676703304052, -0.1697816103696823, 0.0239461977034807, -0.2184012532234192, -0.1122284159064293, -0.0025032388512045, -0.1982196122407913, -0.0088773546740413, -0.0592936985194683, 0.0981788560748100, 0.0590783730149269, 0.1699221283197403, 0.1146017014980316));
	res += mul(get0(rightBottom), float4x4(-0.1190557554364204, 0.0139884017407894, -0.3765408396720886, -0.1967576593160629, -0.0013050300767645, 0.0838785469532013, 0.0467342510819435, 0.0197970345616341, 0.0199079178273678, 0.1127095147967339, -0.0382974669337273, -0.0808331072330475, 0.0045804185792804, 0.1423084437847137, 0.0275978501886129, 0.0051016276702285));
	res += mul(get1(rightBottom), float4x4(0.0694821104407310, -0.1185832619667053, 0.1340767890214920, -0.0096760904416442, -0.0057105780579150, -0.0358094684779644, -0.0208928529173136, -0.0422658622264862, -0.1662766784429550, 0.0397685728967190, -0.0169682707637548, 0.1427496373653412, 0.1324639916419983, 0.0579542480409145, 0.1712465286254883, 0.1062873229384422));
	res = max(res, ZEROS4) + float4(0.0476732961833477, -0.0824369415640831, 1.4746414422988892, 1.6789640188217163) * min(res, ZEROS4);

	return compressTan(res);
}
